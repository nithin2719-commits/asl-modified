<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignFlow | Choose Your Role</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="home-page">
    <div class="home-visuals" aria-hidden="true">
        <div class="home-aurora"></div>
        <div class="home-aurora aurora-secondary"></div>
        <div class="home-grid"></div>
        <div class="floating-orbs">
            <span class="orb orb-1"></span>
            <span class="orb orb-2"></span>
            <span class="orb orb-3"></span>
        </div>
        <div class="beams">
            <span class="beam beam-1"></span>
            <span class="beam beam-2"></span>
            <span class="beam beam-3"></span>
        </div>
        <div class="rings"></div>
        <div class="scanlines"></div>
        <div class="dust">
            <span></span><span></span><span></span><span></span><span></span><span></span>
            <span></span><span></span><span></span><span></span><span></span><span></span>
        </div>
        <div class="vignette"></div>
    </div>

    <header class="home-nav container">
        <div class="brand-mark">
            <div class="brand-logo">
                <i class="fas fa-sign-language"></i>
            </div>
            <div class="brand-text">
                <span class="brand-title">SignFlow</span>
                <span class="brand-tag">ASL Live Interpreter</span>
            </div>
            <span class="live-chip"><span class="dot"></span>Live</span>
        </div>
        <nav class="nav-actions">
            <a class="ghost-link" href="/login">Log in</a>
            <a class="primary-link" href="/signup">Sign up</a>
        </nav>
    </header>

    <main class="home-main container">
        <section class="hero-copy">
            <p class="eyebrow">ASL-first video calling</p>
            <h1>Are you signing or reading today?</h1>
            <p class="lede">
                Pick your lane and we'll tune the experience to you. Signers stream gestures with the model running locally;
                readers get the live transcript with buttery WebRTC video.
            </p>

            <div class="hero-live">
                <div class="live-pill">
                    <span class="dot"></span>
                    <span>Live status</span>
                </div>
                <div class="hotkey-hint">Press <kbd>1</kbd> for Signer ¬∑ <kbd>2</kbd> for Reader</div>
            </div>

            <div class="hero-ctas">
                <a class="cta primary" href="/login?role=primary" data-role-select="signer">
                    <span>I'm a signer</span>
                    <i class="fas fa-arrow-right"></i>
                </a>
                <a class="cta ghost" href="/login?role=secondary" data-role-select="reader">
                    <span>I'm a reader</span>
                    <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            <p class="cta-note">No account? <a href="/signup">Create one</a> or hop in with the demo credentials below.</p>

            <div class="demo-credentials">
                <div class="demo-card" data-credential="primary|primary123">
                    <p class="demo-title">Signer demo</p>
                    <p><code>primary</code> / <code>primary123</code></p>
                    <span class="demo-copy">Click to copy</span>
                </div>
                <div class="demo-card" data-credential="secondary|secondary123">
                    <p class="demo-title">Reader demo</p>
                    <p><code>secondary</code> / <code>secondary123</code></p>
                    <span class="demo-copy">Click to copy</span>
                </div>
            </div>
            <div class="copy-toast" id="copy-toast" role="status" aria-live="polite">Copied!</div>

            <div class="feature-grid" id="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-wave-square"></i></div>
                    <div>
                        <h4>Live waveform</h4>
                        <p>ASL detections pulse in real time so you always know the engine is awake.</p>
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
                    <div>
                        <h4>Private sessions</h4>
                        <p>Cookies stay scoped to this tab with secure defaults for both roles.</p>
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-video"></i></div>
                    <div>
                        <h4>Smooth video</h4>
                        <p>WebRTC keeps the call fluid while the model runs locally for signers.</p>
                    </div>
                </div>
            </div>

            <div class="gesture-basics">
                <div class="gesture-header">
                    <span class="dot"></span>
                    <span>Hand gestures (A-F)</span>
                    <a class="cheat-button" href="/tips">View full guide</a>
                </div>
                <div class="gesture-grid">
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fas fa-hand-fist"></i></div>
                        <div>
                            <h4>A</h4>
                            <p>Make a fist with thumb resting across the fingers.</p>
                        </div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fas fa-hand"></i></div>
                        <div>
                            <h4>B</h4>
                            <p>Flat palm facing camera; thumb tucked across the palm.</p>
                        </div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fas fa-hand-sparkles"></i></div>
                        <div>
                            <h4>C</h4>
                            <p>Curve fingers and thumb into a "C" shape facing the lens.</p>
                        </div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fas fa-hand-point-up"></i></div>
                        <div>
                            <h4>D</h4>
                            <p>Index straight up; other fingers curled; thumb touches middle finger.</p>
                        </div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fas fa-hand-back-fist"></i></div>
                        <div>
                            <h4>E</h4>
                            <p>Curve fingers into a compact fist; thumb rests across the fingertips.</p>
                        </div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon"><i class="fas fa-hand-pointer"></i></div>
                        <div>
                            <h4>F</h4>
                            <p>Touch thumb to index to form a ring; other fingers lifted and relaxed.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="role-cards">
            <article class="role-card active" data-role-card="signer">
                <div class="card-top">
                    <span class="role-pill">Signer</span>
                    <div class="live-wave">
                        <span></span><span></span><span></span><span></span>
                    </div>
                </div>
                <h3>Lead the conversation</h3>
                <p class="card-copy">
                    Share your camera, get instant skeleton overlays, and let the ASL model turn your gestures into text for your partner.
                </p>
                <ul class="card-points">
                    <li><i class="fas fa-bolt"></i>Real-time inference on your device</li>
                    <li><i class="fas fa-shield-alt"></i>Private session &amp; secure cookies</li>
                    <li><i class="fas fa-wand-magic-sparkles"></i>Animated feedback while you sign</li>
                </ul>
                <div class="card-actions">
                    <a class="arrow-link" href="/login?role=primary">Continue as signer</a>
                    <span class="chip">Camera + mic enabled</span>
                </div>
            </article>

            <article class="role-card" data-role-card="reader">
                <div class="card-top">
                    <span class="role-pill secondary">Reader</span>
                    <div class="live-wave alt">
                        <span></span><span></span><span></span><span></span>
                    </div>
                </div>
                <h3>Follow every move</h3>
                <p class="card-copy">
                    Sit back with a synchronized video feed, see the detected letters arrive in real time, and keep the transcript handy.
                </p>
                <ul class="card-points">
                    <li><i class="fas fa-eye"></i>Crystal-clear mirrored video</li>
                    <li><i class="fas fa-closed-captioning"></i>Live transcript stream</li>
                    <li><i class="fas fa-rocket"></i>Low-latency WebRTC transport</li>
                </ul>
                <div class="card-actions">
                    <a class="arrow-link" href="/login?role=secondary">Continue as reader</a>
                    <span class="chip secondary">Transcript mode</span>
                </div>
            </article>

            <article class="role-card about-card" data-role-card="about">
                <div class="card-top">
                    <span class="role-pill secondary">About</span>
                </div>
                <h3>What is SignFlow?</h3>
                <p class="card-copy">
                    A lightweight ASL companion pairing a signer running on-device inference with a reader receiving synced video and transcript over WebRTC.
                </p>
                <ul class="card-points">
                    <li><i class="fas fa-bolt"></i>FastAPI + TensorFlow model stays local for privacy.</li>
                    <li><i class="fas fa-video"></i>WebRTC video for both roles; only signer processes gestures.</li>
                    <li><i class="fas fa-shield-alt"></i>Secure sessions and ready-to-use demo accounts.</li>
                </ul>
                <div class="about-how">
                    <p class="about-how-title"><i class="fas fa-diagram-project"></i>How it works</p>
                    <div class="about-how-grid">
                        <div class="about-step">
                            <span class="about-step-id">1</span>
                            <p class="about-step-title">Pick a role</p>
                            <p class="about-step-copy">Signer streams hand motion. Reader opens transcript mode.</p>
                        </div>
                        <div class="about-step">
                            <span class="about-step-id">2</span>
                            <p class="about-step-title">Process live</p>
                            <p class="about-step-copy">Frames are interpreted in real time on the signer's device.</p>
                        </div>
                        <div class="about-step">
                            <span class="about-step-id">3</span>
                            <p class="about-step-title">Deliver clearly</p>
                            <p class="about-step-copy">Video and detected letters sync instantly for both people.</p>
                        </div>
                    </div>
                </div>
                <div class="card-actions">
                    <a class="arrow-link" href="/tips">View full gesture guide</a>
                    <span class="chip secondary">Minimal & focused</span>
                </div>
            </article>

        </section>

        <section class="live-strip">
            <article class="session-card live-preview">
                <div class="session-header">
                    <span class="session-pill" id="session-uptime">
                        <span class="dot"></span>
                        Uptime | 00:00:00
                    </span>
                    <div class="signal-bars" aria-hidden="true">
                        <span class="bar"></span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                    </div>
                </div>

                <div class="stat-line">
                    <div class="stat-pill">
                        <p class="stat-label">Letters detected</p>
                        <span class="stat-value" data-stat="letters">0</span>
                    </div>
                    <div class="stat-pill">
                        <p class="stat-label">Glass-to-glass latency</p>
                        <span class="stat-value" data-stat="latency">-- ms</span>
                    </div>
                    <div class="stat-pill">
                        <p class="stat-label">Viewers in room</p>
                        <span class="stat-value" data-stat="viewers">1</span>
                    </div>
                </div>

                <div class="detection-card">
                    <div class="detection-body">
                        <div>
                            <div class="strip-meta">
                                <span class="dot"></span>
                                <span>Live detections</span>
                            </div>
                            <div class="detections-list" id="detections-list" aria-live="polite"></div>
                        </div>
                        <div class="latency-wrap">
                            <div class="latency-label">
                                <span>Latency trend</span>
                                <span id="latency-current">-- ms</span>
                            </div>
                            <canvas id="latency-chart" width="320" height="110" aria-label="Latency trend line"></canvas>
                        </div>
                    </div>
                </div>
            </article>

            <aside class="gesture-cheatsheet live-column">
                <div class="cheat-header">
                    <span class="dot"></span>
                    <span class="cheat-title">Quick gesture cheats</span>
                    <button class="cheat-button" id="cheat-rotate" type="button">Shuffle</button>
                </div>
                <div class="cheat-grid cheat-grid-compact" id="cheat-grid">
                    <div class="cheat-card active">
                        <div class="cheat-gesture">üëã</div>
                        <div>
                            <p class="cheat-name">Wake the model</p>
                            <p class="cheat-desc">Raise an open palm to confirm the engine is listening.</p>
                        </div>
                    </div>
                    <div class="cheat-card">
                        <div class="cheat-gesture">ü§ù</div>
                        <div>
                            <p class="cheat-name">Ground check</p>
                            <p class="cheat-desc">Hold both hands steady for one second to reset tracking.</p>
                        </div>
                    </div>
                    <div class="cheat-card">
                        <div class="cheat-gesture">üí°</div>
                        <div>
                            <p class="cheat-name">Light boost</p>
                            <p class="cheat-desc">Tilt toward a lamp; the signal bars react instantly.</p>
                        </div>
                    </div>
                    <div class="cheat-card">
                        <div class="cheat-gesture">üåÄ</div>
                        <div>
                            <p class="cheat-name">Mirror flip</p>
                            <p class="cheat-desc">Tap Ctrl/‚åò + M inside the call to mirror your feed.</p>
                        </div>
                    </div>
                </div>
                <div class="role-context show">
                    Hover any role card or CTA to preview its vibe. Stats and detections above will keep pulsing live.
                </div>
            </aside>
        </section>
    </main>

    <script>
        const statTargets = {
            letters: [180, 360],
            latency: [28, 75],
            viewers: [1, 6]
        };
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)');

        function randomInRange([min, max]) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function updateStats() {
            document.querySelectorAll('[data-stat]').forEach(el => {
                const key = el.dataset.stat;
                if (!statTargets[key]) return;
                const value = randomInRange(statTargets[key]);
                el.textContent = key === 'latency' ? `${value} ms` : value;
            });
        }

        const bars = document.querySelectorAll('.signal-bars .bar');
        function animateBars() {
            if (prefersReducedMotion.matches) return;
            bars.forEach((bar, idx) => {
                const height = 20 + Math.random() * 60;
                const delay = idx * 60;
                bar.animate([
                    { height: `${height}%` },
                    { height: `${height + 20}%` },
                    { height: `${height - 10}%` }
                ], {
                    duration: 1200 + delay,
                    iterations: 1,
                    easing: 'ease-in-out'
                });
            });
        }

        const roleCards = document.querySelectorAll('[data-role-card]');
        function selectRole(role) {
            roleCards.forEach(card => {
                const isMatch = card.dataset.roleCard === role;
                card.classList.toggle('active', isMatch);
            });
        }

        roleCards.forEach(card => {
            card.addEventListener('pointerenter', () => selectRole(card.dataset.roleCard));
            card.addEventListener('focusin', () => selectRole(card.dataset.roleCard));
        });

        document.querySelectorAll('[data-role-select]').forEach(btn => {
            btn.addEventListener('mouseenter', () => selectRole(btn.dataset.roleSelect));
            btn.addEventListener('focus', () => selectRole(btn.dataset.roleSelect));
        });
        // Keyboard hotkeys for quick role switching
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Digit1') selectRole('primary');
            if (e.code === 'Digit2') selectRole('secondary');
        });
        // Keyboard hotkeys for quick role switching
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Digit1') selectRole('primary');
            if (e.code === 'Digit2') selectRole('secondary');
        });

        // Throttled cursor glow so we don't repaint on every pointer event
        let pointerRAF = null;
        document.addEventListener('pointermove', (event) => {
            if (prefersReducedMotion.matches || pointerRAF) return;
            const { clientX, clientY } = event;
            pointerRAF = requestAnimationFrame(() => {
                const root = document.documentElement;
                root.style.setProperty('--mouse-x', `${clientX}px`);
                root.style.setProperty('--mouse-y', `${clientY}px`);
                root.style.setProperty('--mx', `${(clientX / window.innerWidth) * 100}%`);
                root.style.setProperty('--my', `${(clientY / window.innerHeight) * 100}%`);
                pointerRAF = null;
            });
        });

        // Session uptime + health sparkles
        const sessionStart = Date.now();
        const uptimeEl = document.getElementById('session-uptime');
        const cheatGrid = document.getElementById('cheat-grid');
        const cheatRotate = document.getElementById('cheat-rotate');
        const detectionsList = document.getElementById('detections-list');
        const latencyCanvas = document.getElementById('latency-chart');
        const latencyCurrent = document.getElementById('latency-current');
        const ctxLatency = latencyCanvas ? latencyCanvas.getContext('2d') : null;
        const latencyData = [];
        const maxLatencyPoints = 24;
        const lettersPool = ['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','Space','Next','Backspace'];
        const loops = {
            uptime: null,
            cheats: null,
            detections: null,
            stats: null,
            bars: null
        };
        const copyToast = document.getElementById('copy-toast');
        const demoCards = document.querySelectorAll('.demo-card[data-credential]');

        function formatUptime(ms) {
            const totalSec = Math.floor(ms / 1000);
            const h = Math.floor(totalSec / 3600).toString().padStart(2, '0');
            const m = Math.floor((totalSec % 3600) / 60).toString().padStart(2, '0');
            const s = (totalSec % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        let cheatIndex = 0;
        function rotateCheats() {
            if (!cheatGrid) return;
            const cards = cheatGrid.querySelectorAll('.cheat-card');
            cards.forEach(card => card.classList.remove('active'));
            cheatIndex = (cheatIndex + 1) % cards.length;
            cards[cheatIndex].classList.add('active');
        }
        if (cheatRotate) {
            cheatRotate.addEventListener('click', rotateCheats);
        }

        function tickUptime() {
            const elapsed = Date.now() - sessionStart;
            if (uptimeEl) uptimeEl.textContent = `Uptime | ${formatUptime(elapsed)}`;
        }
        loops.uptime = setInterval(tickUptime, 1000);
        tickUptime();

        function addDetection() {
            if (!detectionsList || prefersReducedMotion.matches) return;
            const letter = lettersPool[Math.floor(Math.random() * lettersPool.length)];
            const confidence = (80 + Math.random() * 20).toFixed(0);
            const latency = 40 + Math.random() * 80;
            latencyData.push(latency);
            if (latencyData.length > maxLatencyPoints) latencyData.shift();
            if (latencyCurrent) latencyCurrent.textContent = `${Math.round(latency)} ms`;

            const item = document.createElement('div');
            item.className = 'detection-item';
            item.innerHTML = `<span class="detection-letter">${letter}</span><span class="detection-conf">${confidence}%</span>`;
            detectionsList.prepend(item);
            while (detectionsList.children.length > 5) {
                detectionsList.removeChild(detectionsList.lastChild);
            }
            drawLatency();
        }

        function drawLatency() {
            if (!ctxLatency || !latencyData.length || prefersReducedMotion.matches) return;
            const w = latencyCanvas.width;
            const h = latencyCanvas.height;
            ctxLatency.clearRect(0, 0, w, h);
            ctxLatency.strokeStyle = '#00d4ff';
            ctxLatency.lineWidth = 2;
            const maxVal = Math.max(...latencyData, 120);
            const minVal = Math.min(...latencyData, 30);
            ctxLatency.beginPath();
            latencyData.forEach((v, i) => {
                const x = (i / (maxLatencyPoints - 1)) * w;
                const y = h - ((v - minVal) / (maxVal - minVal)) * h;
                if (i === 0) ctxLatency.moveTo(x, y);
                else ctxLatency.lineTo(x, y);
            });
            ctxLatency.stroke();
        }

        function stopDynamicLoops() {
            ['cheats','detections','stats','bars'].forEach(key => {
                if (loops[key]) {
                    clearInterval(loops[key]);
                    loops[key] = null;
                }
            });
        }

        function startDynamicLoops() {
            stopDynamicLoops();
            if (prefersReducedMotion.matches || document.hidden) return;
            loops.cheats = setInterval(rotateCheats, 2400);
            loops.detections = setInterval(addDetection, 1700);
            loops.stats = setInterval(updateStats, 3200);
            loops.bars = setInterval(animateBars, 1800);
            addDetection();
            updateStats();
            animateBars();
        }

        updateStats();
        animateBars();
        startDynamicLoops();

        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                stopDynamicLoops();
            } else {
                startDynamicLoops();
            }
        });

        prefersReducedMotion.addEventListener('change', () => {
            if (prefersReducedMotion.matches) {
                stopDynamicLoops();
            } else if (!document.hidden) {
                startDynamicLoops();
            }
        });

        function showToast(msg) {
            if (!copyToast) return;
            copyToast.textContent = msg;
            copyToast.classList.add('show');
            setTimeout(() => copyToast.classList.remove('show'), 1600);
        }

        demoCards.forEach(card => {
            card.addEventListener('click', async () => {
                const cred = card.dataset.credential?.split('|');
                if (!cred || cred.length !== 2) return;
                const [user, pass] = cred;
                const text = `${user} / ${pass}`;
                try {
                    await navigator.clipboard.writeText(text);
                    showToast('Demo credentials copied');
                } catch {
                    showToast('Copy failed‚Äîselect manually');
                }
            });
        });

    </script>
</body>
</html>
